# 1. Introduction

mp4â½‚ä»¶æ ¼å¼â¼œè¢«ç§°ä¸ºMPEG-4 Part 14 , å‡ºâ¾ƒMPEG-4æ ‡å‡†ç¬¬14éƒ¨åˆ† .å®ƒæ˜¯â¼€ç§å¤šåª’ä½“æ ¼å¼å®¹å™¨ï¼Œâ¼´æ³›â½¤äºåŒ…è£…è§†é¢‘å’Œâ¾³é¢‘æ•°æ®æµã€æµ·æŠ¥ã€å­—å¹•å’Œå…ƒæ•°æ®ç­‰ã€‚(é¡ºä¾¿â¼€æ , â½¬å‰æµâ¾çš„è§†é¢‘ç¼–ç æ ¼å¼AVC/H264å®šä¹‰åœ¨MPEG-4 Part 10)

mp4â½‚ä»¶æ ¼å¼åŸºäºAppleå…¬å¸çš„QuickTimeæ ¼å¼ , å› æ­¤ , [QuickTime File Format Specification](https://developer.apple.com/documentation/quicktime-file-format#//apple_ref/doc/uid/TP40000939-CH202-TPXREF101)ä¹Ÿå¯ä»¥ä½œä¸ºæˆ‘ä»¬ç ”ç©¶mp4çš„é‡è¦å‚è€ƒ

MP4â½‚ä»¶ç»“æ„çš„èµ„æ–™ : [link]() 

mp4boxâ¼¤æ€å™¨ : [link](https://gpac.github.io/mp4box.js/test/filereader.html)

# 2. Overview

mp4â½‚ä»¶ç”±boxç»„æˆ , æ¯ä¸ªboxåˆ†ä¸ºHeaderå’ŒDataã€‚å…¶ä¸­Headeréƒ¨åˆ†åŒ…å«äº†boxçš„ç±»å‹å’Œâ¼¤â¼© , DataåŒ…å«äº†â¼¦boxæˆ–è€…æ•°æ® , **$\color{red}{\mathbf{boxå¯ä»¥åµŒå¥—â¼¦box}}$**

ä¸‹å›¾æ˜¯â¼€ä¸ªå…¸å‹mp4â½‚ä»¶çš„åŸºæœ¬ç»“æ„ : 

<img src="./assets/image-20240309203113502.png" alt="image-20240309203113502" />  

MP4â½‚ä»¶çš„åŸºæœ¬ç»„æˆå•å…ƒæ˜¯box , ä¹Ÿå°±æ˜¯è¯´MP4â½‚ä»¶æ˜¯ç”±å„ç§å„æ ·çš„boxç»„æˆçš„ , æœ‰parent box , è¿˜æœ‰children boxã€‚å› æ­¤ , è¿™äº›boxesä¹‹é—´å­˜åœ¨â¼€å®šçš„å±‚æ¬¡å…³ç³» , æ€»ç»“å¦‚ä¸‹è¡¨æ‰€ç¤º , è¡¨ä¸­æ ‡è®°å‡ºäº†å„ä¸ªboxå¿…é€‰æˆ–å¯é€‰ç‰¹æ€§ , âˆš ä»£è¡¨Boxå¿…é€‰

| **$\color{red}{\mathbf{ftyp}}$** |                                  |                                  |                                  |                                  |                                      | âˆš    | $\color{red}{\mathbf{file\ type and\ compatibility}}$<br />$\color{red}{\mathbf{â½‚ä»¶ç±»å‹å’Œå…¼å®¹æ€§}}$ |
| -------------------------------- | -------------------------------- | -------------------------------- | -------------------------------- | -------------------------------- | ------------------------------------ | ---- | :----------------------------------------------------------- |
| pdin                             |                                  |                                  |                                  |                                  |                                      |      | progressive download information                             |
| **$\color{red}{\mathbf{moov}}$** |                                  |                                  |                                  |                                  |                                      | âˆš    | $\color{red}{\mathbf{container\ for\ all\ the\ metadata}}$<br/>$\color{red}{\mathbf{æ‰€æœ‰å…ƒæ•°æ®çš„å®¹å™¨}}$ |
|                                  | **$\color{red}{\mathbf{mvhd}}$** |                                  |                                  |                                  |                                      | âˆš    | $\color{red}{\mathbf{movie\ header,\ overall\ declarations}}$<br/>$\color{red}{\mathbf{ç”µå½±å¤´\ ,\ æ•´ä½“å£°æ˜}}$ |
|                                  | **$\color{red}{\mathbf{trak}}$** |                                  |                                  |                                  |                                      | âˆš    | $\color{red}{\mathbf{container\ for\ an\ individual\ track\ or\ stream}}$<br/>$\color{red}{\mathbf{å•ä¸ªè½¨æˆ–æµçš„å®¹å™¨}}$ |
|                                  |                                  | **$\color{red}{\mathbf{tkhd}}$** |                                  |                                  |                                      | âˆš    | $\color{red}{\mathbf{track\ header,\ overall\ information\ about\ the track}}$<br />$\color{red}{\mathbf{è½¨çš„å¤´éƒ¨\ ,\ å…³äºè¯¥è½¨çš„æ¦‚æ‹¬ä¿¡æ¯\ ,\ â½å¦‚è§†é¢‘å®½â¾¼}}$ |
|                                  |                                  | tref                             |                                  |                                  |                                      | âˆš    | track reference container                                    |
|                                  |                                  | edts                             |                                  |                                  |                                      | âˆš    | edit list container                                          |
|                                  |                                  |                                  | elst                             |                                  |                                      | âˆš    | an edit list                                                 |
|                                  |                                  | **$\color{red}{\mathbf{mdia}}$** |                                  |                                  |                                      | âˆš    | $\color{red}{\mathbf{container\ for\ the\ media\ information\ in\ a\ track}}$<br/>$\color{red}{\mathbf{è½¨åª’ä½“ä¿¡æ¯çš„å®¹å™¨}}$ |
|                                  |                                  |                                  | **$\color{red}{\mathbf{mdhd}}$** |                                  |                                      | âˆš    | **$\color{red}{\mathbf{media\ header,\ overall\ information\ about\ the\ media}}$**<br/>$\color{red}{\mathbf{åª’ä½“å¤´\ ,\ å…³äºåª’ä½“çš„æ€»ä½“ä¿¡æ¯}}$ |
|                                  |                                  |                                  | **$\color{red}{\mathbf{hdlr}}$** |                                  |                                      | âˆš    | $\color{red}{\mathbf{handler,\ declares\ the\ media\ (handler)\ type}}$<br />$\color{red}{\mathbf{åª’ä½“çš„æ’­æ”¾è¿‡ç¨‹ä¿¡æ¯}}$ |
|                                  |                                  |                                  | **$\color{red}{\mathbf{minf}}$** |                                  |                                      | âˆš    | $\color{red}{\mathbf{media\ information\ container}}$<br/>$\color{red}{\mathbf{åª’ä½“ä¿¡æ¯å®¹å™¨}}$ |
|                                  |                                  |                                  |                                  | vmhd                             |                                      |      | video media header, overall information<br/>(video track only) |
|                                  |                                  |                                  |                                  | smhd                             |                                      |      | sound media header, overall information<br/>(sound track only) |
|                                  |                                  |                                  |                                  | hmhd                             |                                      |      | hint media header, overall information<br/>(hint track only) |
|                                  |                                  |                                  |                                  | nmhd                             |                                      |      | Null media header, overall information<br/>(some tracks only) |
|                                  |                                  |                                  |                                  | **$\color{red}{\mathbf{dinf}}$** |                                      | âˆš    | $\color{red}{\mathbf{data\ information\ box,\ container}}$<br/>$\color{red}{\mathbf{æ•°æ®ä¿¡æ¯box\ ,\ å®¹å™¨}}$ |
|                                  |                                  |                                  |                                  |                                  | **$\color{red}{\mathbf{dref}}$**     | âˆš    | $\color{red}{\mathbf{data\ reference\ box,\ declares\ source(s)\ of\ media\ data\ in\ track}}$<br/>$\color{red}{\mathbf{å¦‚ä½•å®šä½åª’ä½“ä¿¡æ¯}}$ |
|                                  |                                  |                                  |                                  | **$\color{red}{\mathbf{stbl}}$** |                                      | âˆš    | $\color{red}{\mathbf{sample\ table\ box,\ container\ for\ the\ time\ /\ space\ map}}$<br/>$\color{red}{\mathbf{åŒ…å«äº†trackä¸­çš„sampleçš„æ‰€æœ‰æ—¶é—´å’Œä½ç½®ä¿¡æ¯\ ,\ ä»¥åŠsampleçš„ç¼–è§£ç ç­‰ä¿¡æ¯ã€‚}}$<br />$\color{red}{\mathbf{åˆ©â½¤è¿™ä¸ªè¡¨å¯ä»¥è§£æsampleçš„æ—¶åºã€ç±»å‹ã€â¼¤â¼©ä»¥åŠåœ¨å„â¾ƒå­˜å‚¨å®¹å™¨ä¸­çš„ä½ç½®}}$ |
|                                  |                                  |                                  |                                  |                                  | **$\color{red}{\mathbf{stsd}}$**     | âˆš    | $\color{red}{\mathbf{sample\ descriptions\ (codec\ types\ ,\ initialization\ etc.)}}$<br/>$\color{red}{\mathbf{å¦‚æœæ˜¯è§†é¢‘\ ,\ åŒ…å«:\ ç¼–ç ç±»å‹ã€å®½â¾¼ã€é•¿åº¦ç­‰ä¿¡æ¯;}}$<br/>$\color{red}{\mathbf{å¦‚æœæ˜¯â¾³é¢‘\ ,\ åŒ…å«:\ å£°é“ã€é‡‡æ ·ç‡ç­‰ä¿¡æ¯}}$ |
|                                  |                                  |                                  |                                  |                                  | **$\color{red}{\mathbf{stts}}$**     | âˆš    | **$\color{red}{\mathbf{(decoding)\ time-to-sample}}$**<br/>**$\color{red}{\mathbf{æè¿°äº†sampleæ—¶åºçš„æ˜ å°„â½…æ³• , æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæ‰¾åˆ°ä»»ä½•æ—¶é—´çš„sample}}$** |
|                                  |                                  |                                  |                                  |                                  | ctts                                 |      | (composition) time to sample                                 |
|                                  |                                  |                                  |                                  |                                  | **$\color{red}{\mathbf{stsc}}$**     | âˆš    | $\color{red}{\mathbf{sample-to-chunk,\ partial\ data-offset\ information}}$<br/>$\color{red}{\mathbf{â½¤chunkç»„ç»‡sampleå¯ä»¥â½…ä¾¿ä¼˜åŒ–æ•°æ®è·å– , }}$<br/>$\color{red}{\mathbf{â¼€ä¸ªchunkåŒ…å«â¼€ä¸ªæˆ–å¤šä¸ªsample}}$ |
|                                  |                                  |                                  |                                  |                                  | **$\color{SkyBlue}{\mathbf{stsz}}$** |      | **$\color{SkyBlue}{\mathbf{sample\ sizes\ (framing)}}$**<br/>**$\color{SkyBlue}{\mathbf{æ¯ä¸ªsampleçš„â¼¤â¼©}}$**<br/>$\color{SkyBlue}{\mathbf{è™½ç„¶è¿™â¾¥æ²¡æœ‰æ‰“å‹¾ , ä½†å¯¹äºmp4è¿˜æ˜¯â¾®å¸¸å¿…è¦çš„}}$ |
|                                  |                                  |                                  |                                  |                                  | stz2                                 |      | compact sample sizes (framing)                               |
|                                  |                                  |                                  |                                  |                                  | **$\color{red}{\mathbf{stco}}$**     | âˆš    | $\color{red}{\mathbf{chunk\ offset\ partial\ data-offset\ information}}$<br/>$\color{red}{\mathbf{å®šä¹‰äº†æ¯ä¸ªchunkåœ¨åª’ä½“æµä¸­çš„åç§»ä½ç½®}}$ |
|                                  |                                  |                                  |                                  |                                  | co6                                  |      | 64-bit chunk offset                                          |
|                                  |                                  |                                  |                                  |                                  | 4                                    |      |                                                              |
|                                  |                                  |                                  |                                  |                                  | **$\color{SkyBlue}{\mathbf{stss}}$** |      | $\color{SkyBlue}{\mathbf{sync\ sample\ table\ (random\ access points)}}$<br/>$\color{SkyBlue}{\mathbf{â½¤äºç¡®å®šmediaä¸­çš„å…³é”®å¸§}}$ |
|                                  |                                  |                                  |                                  |                                  | stsh                                 |      | shadow sync sample table                                     |
|                                  |                                  |                                  |                                  |                                  | padb                                 |      | sample padding bits                                          |
|                                  |                                  |                                  |                                  |                                  | stdp                                 |      | sample degradation priority                                  |
|                                  |                                  |                                  |                                  |                                  | sdtp                                 |      | independent and disposable samples                           |
|                                  |                                  |                                  |                                  |                                  | sbgp                                 |      | sample-to-group                                              |
|                                  |                                  |                                  |                                  |                                  | sgpd                                 |      | sample group description                                     |
|                                  |                                  |                                  |                                  |                                  | subs                                 |      | sub-sample information                                       |
|                                  | mvex                             |                                  |                                  |                                  |                                      |      | movie extends box                                            |
|                                  |                                  | mehd                             |                                  |                                  |                                      |      | movie extends header box                                     |
|                                  |                                  | trex                             |                                  |                                  |                                      | âˆš    | track extends defaults                                       |
|                                  | ipmc                             |                                  |                                  |                                  |                                      |      | IPMP Control Box                                             |
| moof                             |                                  |                                  |                                  |                                  |                                      |      | movie fragment                                               |
|                                  | mfhd                             |                                  |                                  |                                  |                                      | âˆš    | movie fragment header                                        |
|                                  | traf                             |                                  |                                  |                                  |                                      |      | track fragment                                               |
|                                  |                                  | tfhd                             |                                  |                                  |                                      | âˆš    | track fragment header                                        |
|                                  |                                  | trun                             |                                  |                                  |                                      |      | track fragment run                                           |
|                                  |                                  | sdtp                             |                                  |                                  |                                      |      | independent and disposable samples                           |
|                                  |                                  | sbgp                             |                                  |                                  |                                      |      | sample-to-group                                              |
|                                  |                                  | subs                             |                                  |                                  |                                      |      | sub-sample information                                       |
| mfra                             |                                  |                                  |                                  |                                  |                                      |      | movie fragment random access                                 |
|                                  | tfra                             |                                  |                                  |                                  |                                      |      | track fragment random access                                 |
|                                  | mfro                             |                                  |                                  |                                  |                                      | âˆš    | movie fragment random access offset                          |
| mdat                             |                                  |                                  |                                  |                                  |                                      |      | media data container                                         |
| free                             |                                  |                                  |                                  |                                  |                                      |      | free space                                                   |
| skip                             |                                  |                                  |                                  |                                  |                                      |      | free space                                                   |
|                                  | udta                             |                                  |                                  |                                  |                                      |      | user-data                                                    |
|                                  |                                  | cprt                             |                                  |                                  |                                      |      | copyright etc                                                |
| meta                             |                                  |                                  |                                  |                                  |                                      |      | metadata                                                     |
|                                  | hdlr                             |                                  |                                  |                                  |                                      | âˆš    | handler, declares the metadata (handler) type                |
|                                  | dinf                             |                                  |                                  |                                  |                                      |      | data information box, container                              |
|                                  |                                  | dref                             |                                  |                                  |                                      |      | data reference box, declares source(s) of metadata items     |
|                                  | ipmc                             |                                  |                                  |                                  |                                      |      | IPMP Control Box                                             |
|                                  | iloc                             |                                  |                                  |                                  |                                      |      | item location                                                |
|                                  | ipro                             |                                  |                                  |                                  |                                      |      | item protection                                              |
|                                  |                                  | sinf                             |                                  |                                  |                                      |      | protection scheme information box                            |
|                                  |                                  |                                  | frma                             |                                  |                                      |      | original format box                                          |
|                                  |                                  |                                  | imif                             |                                  |                                      |      | IPMP Information box                                         |
|                                  |                                  |                                  | schm                             |                                  |                                      |      | scheme type box                                              |
|                                  |                                  |                                  | schi                             |                                  |                                      |      | scheme information box                                       |
|                                  | iinf                             |                                  |                                  |                                  |                                      |      | item information                                             |
|                                  | xml                              |                                  |                                  |                                  |                                      |      | XML container                                                |
|                                  | bxml                             |                                  |                                  |                                  |                                      |      | binary XML container                                         |
|                                  | pitm                             |                                  |                                  |                                  |                                      |      | primary item reference                                       |
|                                  | fiin                             |                                  |                                  |                                  |                                      |      | file delivery item information                               |
|                                  |                                  | paen                             |                                  |                                  |                                      |      | partition entry                                              |
|                                  |                                  |                                  | fpar                             |                                  |                                      |      | file partition                                               |
|                                  |                                  |                                  | fecr                             |                                  |                                      |      | FEC reservoir                                                |
|                                  |                                  | segr                             |                                  |                                  |                                      |      | file delivery session group                                  |
|                                  |                                  | gitn                             |                                  |                                  |                                      |      | group id to name                                             |
|                                  |                                  | tsel                             |                                  |                                  |                                      |      | track selection                                              |
| meco                             |                                  |                                  |                                  |                                  |                                      |      | additional metadata container                                |
|                                  | mere                             |                                  |                                  |                                  |                                      |      | metabox relation                                             |

æœ¬â½‚ä½¿â½¤mediainfoå’Œmp4boxè¿›â¾åˆ†æ

å›¾ä¸­çœ‹åˆ°mp4â½‚ä»¶ç”±â¼ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ† , ä¸‹â¾¯ä»¥ğŸ“ 2_audio_track_5s.mp4â½‚ä»¶ä¸ºåˆ†ææ¡ˆä¾‹

## 2.1 ftyp

File Type Box , â¼€èˆ¬åœ¨â½‚ä»¶çš„å¼€å§‹ä½ç½® , æè¿°çš„â½‚ä»¶çš„ç‰ˆæœ¬ã€å…¼å®¹åè®®ç­‰

ftypå†…å®¹

> ```tex
> 000000 File Type (32 bytes)
> 000000  Header (8 bytes)
> 000000   Size:                                 32 (0x00000020)
> 000004   Name:                                 ftyp
> 000008  MajorBrand:                            isom
> 00000C  MajorBrandVersion:                     512 (0x00000200)
> 000010  CompatibleBrand:                       isom
> 000014  CompatibleBrand:                       iso2
> 000018  CompatibleBrand:                       avc1
> 00001C  CompatibleBrand:                       mp41
> ```

## 2.2 moov

Movie Box , åŒ…å«æœ¬â½‚ä»¶ä¸­æ‰€æœ‰åª’ä½“æ•°æ®çš„å®è§‚æè¿°ä¿¡æ¯ä»¥åŠæ¯è·¯åª’ä½“è½¨é“çš„å…·ä½“ä¿¡æ¯ã€‚â¼€èˆ¬ä½äºæ”¾åœ¨â½‚ä»¶æœ«å°¾ , ä½†å¦‚æœä¸ºäº†â½€æŒhttpè¾¹ä¸‹è½½è¾¹æ’­æ”¾åˆ™éœ€è¦å°†moovæå‰ã€‚æ³¨æ„ , $\color{red}{\mathbf{å½“æ”¹å˜moovä½ç½®æ—¶,å†…éƒ¨â¼€äº›å€¼éœ€è¦é‡æ–°è®¡ç®—}}$â€‹

moovå†…å®¹

> ```tex
> 14B2CE File header (10341 bytes)
> 14B2CE  Header (8 bytes)
> 14B2CE   Size:                                 10341 (0x00002865)
> 14B2D2   Name:                                 moov
> ```

moové‡Œé¢çš„boxæ‰æ˜¯æˆ‘ä»¬ä¸»è¦åˆ†æçš„box  

<img src="assets/image-20240311093535367.png" alt="image-20240311093535367" />  

## 2.3 mdat

Media Data Box , å­˜æ”¾å…·ä½“çš„åª’ä½“æ•°æ®

> ```tex
> 000028 Data (1356454 bytes)
> 000028  Header (8 bytes)
> 000028   Size:                                 1356454 (0x0014B2A6)
> 00002C   Name:                                 mdat
> 000030  Data:                                  (1356446 bytes)
> ```

# 3. Moov Insider

mp4çš„åª’ä½“æ•°æ®ä¿¡æ¯ä¸»è¦å­˜æ”¾åœ¨Moov Boxä¸­ , æ˜¯æˆ‘ä»¬éœ€è¦åˆ†æçš„é‡ç‚¹ã€‚moovçš„ä¸»è¦ç»„æˆéƒ¨åˆ†å¦‚ä¸‹ : 

## 3.1 mvhd

Movie Header Box , è®°å½•æ•´ä¸ªåª’ä½“â½‚ä»¶çš„æè¿°ä¿¡æ¯ , å¦‚åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€æ—¶é—´åº¦é‡æ ‡å°ºã€å¯æ’­æ”¾æ—¶é•¿ç­‰

ä¾‹å¦‚ : å¯ä»¥è·å–æ–‡ä»¶ä»¶ä¿¡æ¯å¦‚æ—¶é•¿ä¸º Duration: 5016 ms

mvhdå†…å®¹

> ```tex
> 14B2D6  Movie header (108 bytes)
> 14B2D6   Header (8 bytes)
> 14B2D6    Size:                                108 (0x0000006C)
> 14B2DA    Name:                                mvhd
> 14B2DE   Version:                              0 (0x00)
> 14B2DF   Flags:                                0 (0x000000)
> 14B2E2   Creation time:                        0 (0x00000000) - 
> 14B2E6   Modification time:                    0 (0x00000000) - 
> 14B2EA   Time scale:                           1000 (0x000003E8) - 1000 Hz
> 14B2EE   Duration:                             5016 (0x00001398) - 5016 ms
> 14B2F2   Preferred rate:                       65536 (0x00010000) - 1.000
> 14B2F6   Preferred volume:                     256 (0x0100) - 1.000
> 14B2F8   Reserved:                             (10 bytes)
> 14B302   Matrix structure (36 bytes)
> 14B302    a (width scale):                     1.000
> 14B306    b (width rotate):                    0.000
> 14B30A    u (width angle):                     0.000
> 14B30E    c (height rotate):                   0.000
> 14B312    d (height scale):                    1.000
> 14B316    v (height angle):                    0.000
> 14B31A    x (position left):                   0.000
> 14B31E    y (position top):                    0.000
> 14B322    w (divider):                         1.000
> 14B326   Preview time:                         0 (0x00000000)
> 14B32A   Preview duration:                     0 (0x00000000)
> 14B32E   Poster time:                          0 (0x00000000)
> 14B332   Selection time:                       0 (0x00000000)
> 14B336   Selection duration:                   0 (0x00000000)
> 14B33A   Current time:                         0 (0x00000000)
> 14B33E   Next track ID:                        4 (0x00000004)
> ```

<img src="assets/image-20240311095951225.png" alt="image-20240311095951225" /> 

## 3.2 udta

User Data Box , è‡ªå®šä¹‰æ•°æ®

> ```tex
> 14DAD1  User Data (98 bytes)
> 14DAD1   Header (8 bytes)
> 14DAD1    Size:                                98 (0x00000062)
> 14DAD5    Name:                                udta
> ```

## 3.3 track

Track Box , è®°å½•åª’ä½“æµä¿¡æ¯ , æ–‡ä»¶ä¸­å¯ä»¥å­˜åœ¨ **$\color{red}{\mathbf{â¼€ä¸ªæˆ–å¤šä¸ªtrack}}$** , å®ƒä»¬ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„  

<img src="assets/image-20240311101500562.png" alt="image-20240311101500562" /> 

æœ¬æ¬¡çš„ç¤ºä¾‹æ–‡ä»¶é‡Œé¢æœ‰3ä¸ªtrack

æ¯ä¸ªtrackåŒ…å«ä»¥ä¸‹å‡ ä¸ªç»„æˆéƒ¨åˆ† : 

### 3.3.1 tkhd

Track Header Box , åŒ…å«å…³äºåª’ä½“æµçš„å¤´ä¿¡æ¯ã€‚ä¸‹å›¾ç¤ºä¾‹ä¸­ , å¯ä»¥çœ‹åˆ°æµä¿¡æ¯å¦‚è§†é¢‘æµå®½åº¦(width)1920 , é«˜åº¦(height)800

1. è§†é¢‘tkhdå†…å®¹

> ```tex
> 14CEA6   Track Header - 3 (0x3) - 4875 (0x130B) ms (92 bytes)
> 14CEA6    Header (8 bytes)
> 14CEA6     Size:                               92 (0x0000005C)
> 14CEAA     Name:                               tkhd
> 14CEAE    Version:                             0 (0x00)
> 14CEAF    Flags:                               3 (0x000003)
> 14CEB2    Track Enabled:                       Yes
> 14CEB2    Track in Movie:                      Yes
> 14CEB2    Track in Preview:                    No
> 14CEB2    Track in Poster:                     No
> 14CEB2    Creation time:                       0 (0x00000000) - 
> 14CEB6    Modification time:                   0 (0x00000000) - 
> 14CEBA    Track ID:                            3 (0x00000003)
> 14CEBE    Reserved:                            0 (0x00000000)
> 14CEC2    Duration:                            4875 (0x0000130B) - 4875 (0x130B) ms
> 14CEC6    Reserved:                            0 (0x00000000)
> 14CECA    Reserved:                            0 (0x00000000)
> 14CECE    Layer:                               0 (0x0000)
> 14CED0    Alternate group:                     2 (0x0002)
> 14CED2    Volume:                              0 (0x0000) - 0.000
> 14CED4    Reserved:                            0 (0x0000)
> 14CED6    Matrix structure (36 bytes)
> 14CED6     a (width scale):                    1.000
> 14CEDA     b (width rotate):                   0.000
> 14CEDE     u (width angle):                    0.000
> 14CEE2     c (height rotate):                  0.000
> 14CEE6     d (height scale):                   1.000
> 14CEEA     v (height angle):                   0.000
> 14CEEE     x (position left):                  0.000
> 14CEF2     y (position top):                   0.000
> 14CEF6     w (divider):                        1.000
> 14CEFA    Track width:                         1920.000
> 14CEFE    Track height:                        800.000
> ```

<img src="assets/image-20240311110856586.png" alt="image-20240311110856586" /> 

2. éŸ³é¢‘çš„tkhd , åˆ™æ¯”å¦‚ durationã€volume

> ```tex
> 14B34A   Track Header - 1 (0x1) - 5016 (0x1398) ms (92 bytes)
> 14B34A    Header (8 bytes)
> 14B34A     Size:                               92 (0x0000005C)
> 14B34E     Name:                               tkhd
> 14B352    Version:                             0 (0x00)
> 14B353    Flags:                               3 (0x000003)
> 14B356    Track Enabled:                       Yes
> 14B356    Track in Movie:                      Yes
> 14B356    Track in Preview:                    No
> 14B356    Track in Poster:                     No
> 14B356    Creation time:                       0 (0x00000000) - 
> 14B35A    Modification time:                   0 (0x00000000) - 
> 14B35E    Track ID:                            1 (0x00000001)
> 14B362    Reserved:                            0 (0x00000000)
> 14B366    Duration:                            5016 (0x00001398) - 5016 (0x1398) ms
> 14B36A    Reserved:                            0 (0x00000000)
> 14B36E    Reserved:                            0 (0x00000000)
> 14B372    Layer:                               0 (0x0000)
> 14B374    Alternate group:                     0 (0x0000)
> 14B376    Volume:                              256 (0x0100) - 1.000
> 14B378    Reserved:                            0 (0x0000)
> 14B37A    Matrix structure (36 bytes)
> 14B37A     a (width scale):                    1.000
> 14B37E     b (width rotate):                   0.000
> 14B382     u (width angle):                    0.000
> 14B386     c (height rotate):                  0.000
> 14B38A     d (height scale):                   1.000
> 14B38E     v (height angle):                   0.000
> 14B392     x (position left):                  0.000
> 14B396     y (position top):                   0.000
> 14B39A     w (divider):                        1.000
> 14B39E    Track width:                         0.000
> 14B3A2    Track height:                        0.000
> ```

<img src="assets/image-20240311111015163.png" alt="image-20240311111015163" /> 

### 3.3.2 mdia

Media Box , è¿™æ˜¯â¼€ä¸ªåŒ…å«trackåª’ä½“æ•°æ®ä¿¡æ¯çš„ container box , å­ boxåŒ…æ‹¬ : 

1. mdhd : Media Header Box , å­˜æ”¾è§†é¢‘æµåˆ›å»ºæ—¶é—´ , é•¿åº¦ç­‰ä¿¡æ¯
2. hdlr : Handler Reference Box , åª’ä½“çš„æ’­æ”¾è¿‡ç¨‹ä¿¡æ¯
3. minf : Media Information Box , è§£é‡Štrackåª’ä½“æ•°æ®çš„handler-specificä¿¡æ¯

minf åŒæ ·æ˜¯ä¸ªcontainer box , å…¶å†…éƒ¨éœ€è¦å…³æ³¨çš„å†…å®¹æ˜¯stbl , è¿™ä¹Ÿæ˜¯moovä¸­æœ€å¤æ‚çš„éƒ¨åˆ†ã€‚stblåŒ…å«äº†åª’ä½“æµæ¯â¼€ä¸ªsampleåœ¨æ–‡ä»¶ä»¶ä¸­çš„offset , pts , durationç­‰ä¿¡æ¯ã€‚æƒ³è¦æ’­æ”¾â¼€ä¸ªmp4æ–‡ä»¶ , å¿…é¡»æ ¹æ®stblæ­£ç¡®æ‰¾åˆ°æ¯ä¸ªsampleå¹¶é€ç»™è§£ç å™¨

mdiaå†…å®¹

> ```tex
> 14B3CA   Media (3184 bytes)
> 14B3CA    Header (8 bytes)
> 14B3CA     Size:                               3184 (0x00000C70)
> 14B3CE     Name:                               mdia
> ```

<img src="assets/image-20240311104906794.png" alt="image-20240311104906794" /> 

#### 3.3.2.1 mdhd 

Media Header Box , å­˜æ”¾è§†é¢‘æµåˆ›å»ºæ—¶é—´ , é•¿åº¦ç­‰ä¿¡æ¯

è§†é¢‘çš„mdhd , Time scale , Durationç­‰ä¿¡æ¯  

1. è§†é¢‘mdhdå†…å®¹

> ```tex
> 14CF3A    Media Header (32 bytes)
> 14CF3A     Header (8 bytes)
> 14CF3A      Size:                              32 (0x00000020)
> 14CF3E      Name:                              mdhd
> 14CF42     Version:                            0 (0x00)
> 14CF43     Flags:                              0 (0x000000)
> 14CF46     Creation time:                      0 (0x00000000) - 
> 14CF4A     Modification time:                  0 (0x00000000) - 
> 14CF4E     Time scale:                         90000 (0x00015F90)
> 14CF52     Duration:                           438750 (0x0006B1DE) - 4875 (0x130B) ms
> 14CF56     Language:                           21956 (0x55C4) - und
> 14CF58     Quality:                            0 (0x0000)
> ```

<img src="assets/image-20240311112415602.png" alt="image-20240311112415602" /> 

éŸ³é¢‘çš„mdhd , ä¹Ÿç±»ä¼¼è§†é¢‘mdhdçš„ä¿¡æ¯ , ä½†è¦æ³¨æ„ **$\color{red}{\mathbf{Time\ scale}}$** , æˆ‘ä»¬åœ¨è®¡ç®—æ—¶é—´æˆ³çš„æ—¶å€™éƒ½è¦ä½¿ç”¨è¯¥ **$\color{red}{\mathbf{Time\ scale\ ,\ å¯¹åº”æˆ‘ä»¬æµé‡Œé¢çš„AVStream->time\_base}}$**

2. éŸ³é¢‘mdhdnå†…å®¹

> ```tex
> 14B3D2    Media Header (32 bytes)
> 14B3D2     Header (8 bytes)
> 14B3D2      Size:                              32 (0x00000020)
> 14B3D6      Name:                              mdhd
> 14B3DA     Version:                            0 (0x00)
> 14B3DB     Flags:                              0 (0x000000)
> 14B3DE     Creation time:                      0 (0x00000000) - 
> 14B3E2     Modification time:                  0 (0x00000000) - 
> 14B3E6     Time scale:                         44100 (0x0000AC44)
> 14B3EA     Duration:                           221184 (0x00036000) - 5015 (0x1397) ms
> 14B3EE     Language:                           21956 (0x55C4) - und
> 14B3F0     Quality:                            0 (0x0000)
> ```

<img src="assets/image-20240311112517657.png" alt="image-20240311112517657" /> 

#### 3.3.2.2 hdlr

Handler Reference Box , åª’ä½“çš„æ’­æ”¾è¿‡ç¨‹ä¿¡æ¯

è§†é¢‘çš„hdlr , é‡ç‚¹ **$\color{red}{\mathbf{Component\ subtype\ :\ vide}}$**

> ```tex
> 14CF5A    Handler Reference (45 bytes)
> 14CF5A     Header (8 bytes)
> 14CF5A      Size:                              45 (0x0000002D)
> 14CF5E      Name:                              hdlr
> 14CF62     Version:                            0 (0x00)
> 14CF63     Flags:                              0 (0x000000)
> 14CF66     Component type:                     
> 14CF6A     Component subtype:                  vide
> 14CF6E     Component manufacturer:             
> 14CF72     Component flags:                    0 (0x00000000)
> 14CF76     Component flags mask:               0 (0x00000000)
> 14CF7A     Component name:                     VideoHandler
> ```

<img src="assets/image-20240311140100238.png" alt="image-20240311140100238" /> 

éŸ³é¢‘çš„hdlr ,   **$\color{red}{\mathbf{Component\ subtype\ :\ soun}}$**

å¦‚æœæˆ‘ä»¬å¤šä¸ªéŸ³è½¨çš„æ—¶å€™ , Component name : ç²¤è¯­

> ```tex
> 14B3F2    Handler Reference (39 bytes)
> 14B3F2     Header (8 bytes)
> 14B3F2      Size:                              39 (0x00000027)
> 14B3F6      Name:                              hdlr
> 14B3FA     Version:                            0 (0x00)
> 14B3FB     Flags:                              0 (0x000000)
> 14B3FE     Component type:                     
> 14B402     Component subtype:                  soun
> 14B406     Component manufacturer:             
> 14B40A     Component flags:                    0 (0x00000000)
> 14B40E     Component flags mask:               0 (0x00000000)
> 14B412     Component name:                     ç²¤è¯­
> ```

<img src="assets/image-20240311140619611.png" alt="image-20240311140619611" /> 

Component name : å›½è¯­

> ```tex
> 14C0EA    Handler Reference (39 bytes)
> 14C0EA     Header (8 bytes)
> 14C0EA      Size:                              39 (0x00000027)
> 14C0EE      Name:                              hdlr
> 14C0F2     Version:                            0 (0x00)
> 14C0F3     Flags:                              0 (0x000000)
> 14C0F6     Component type:                     
> 14C0FA     Component subtype:                  soun
> 14C0FE     Component manufacturer:             
> 14C102     Component flags:                    0 (0x00000000)
> 14C106     Component flags mask:               0 (0x00000000)
> 14C10A     Component name:                     å›½è¯­
> ```

<img src="assets/image-20240311140648462.png" alt="image-20240311140648462" /> 

#### 3.3.2.3 minf

minf : Media Information Box , è§£é‡Štrackåª’ä½“æ•°æ®çš„handler-specificä¿¡æ¯ã€‚minfåŒæ ·æ˜¯ä¸ªcontainer box , å…¶å†…éƒ¨éœ€è¦å…³æ³¨çš„å†…å®¹æ˜¯stbl , è¿™ä¹Ÿæ˜¯moovä¸­æœ€å¤æ‚çš„éƒ¨åˆ†ã€‚

stblåŒ…å«äº†åª’ä½“æµæ¯â¼€ä¸ªsampleåœ¨æ–‡ä»¶ä¸­çš„offset , pts , durationç­‰ä¿¡æ¯ã€‚æƒ³è¦æ’­æ”¾â¼€ä¸ªmp4â½‚ä»¶ , å¿…é¡»æ ¹æ®stblæ­£ç¡®æ‰¾åˆ°æ¯ä¸ªsampleå¹¶é€ç»™è§£ç å™¨

è€Œä¸”éœ€è¦æ³¨æ„çš„æ˜¯ , minfâ¾¥â¾¯çš„å­å®¹å™¨ , éŸ³é¢‘å’Œè§†é¢‘è½¨æ˜¯æœ‰åŒºåˆ«çš„ , æ¯”å¦‚è§†é¢‘è½¨ : **$\color{red}{\mathbf{vmhd}}$** , éŸ³é¢‘è½¨åˆ™ä¸º : **$\color{red}{\mathbf{smhd}}$**  

1. vmhd

> ```tex
> 14CF8F     Video Media Header (20 bytes)
> 14CF8F      Header (8 bytes)
> 14CF8F       Size:                             20 (0x00000014)
> 14CF93       Name:                             vmhd
> 14CF97      Version:                           0 (0x00)
> 14CF98      Flags:                             1 (0x000001)
> 14CF9B      Graphic mode:                      0 (0x0000)
> 14CF9D      Graphic mode color R:              0 (0x0000)
> 14CF9F      Graphic mode color G:              0 (0x0000)
> 14CFA1      Graphic mode color B:              0 (0x0000)
> ```

<img src="assets/image-20240311140912380.png" alt="image-20240311140912380" /> 

2. smhd

> ```tex
> 14B421     Sound Media Header (16 bytes)
> 14B421      Header (8 bytes)
> 14B421       Size:                             16 (0x00000010)
> 14B425       Name:                             smhd
> 14B429      Version:                           0 (0x00)
> 14B42A      Flags:                             0 (0x000000)
> 14B42D      Audio balance:                     0 (0x0000)
> 14B42F      Reserved:                          0 (0x0000)
> ```

<img src="assets/image-20240311140932150.png" alt="image-20240311140932150" /> 

# 4. Stbl Insider

Sample Table Box , ä¸Šâ½‚æåˆ°mdiaä¸­æœ€ä¸»è¦çš„éƒ¨åˆ†æ˜¯å­˜æ”¾â½‚ä»¶ä¸­æ¯ä¸ªsampleä¿¡æ¯çš„stblã€‚åœ¨è§£æstblå‰ , æˆ‘ä»¬éœ€è¦åŒºåˆ†chunkå’Œsampleè¿™ä¸¤ä¸ªæ¦‚å¿µã€‚
åœ¨mp4â½‚ä»¶ä¸­ , sampleæ˜¯â¼€ä¸ªåª’ä½“æµçš„åŸºæœ¬å•å…ƒ , ä¾‹å¦‚è§†é¢‘æµçš„â¼€ä¸ªsampleä»£è¡¨å®é™…çš„nalæ•°æ®ã€‚chunkæ˜¯æ•°æ®å­˜å‚¨çš„åŸºæœ¬å•ä½ , å®ƒæ˜¯ä¸€ç³»åˆ—sampleæ•°æ®çš„é›†åˆ , ä¸€ä¸ªchunkä¸­å¯ä»¥åŒ…å«â¼€ä¸ªæˆ–å¤šçš„sample

<img src="assets/image-20240311145050516.png" alt="image-20240311145050516" style="zoom:150%;" /> 

â¼€ä¸ªchunkåŒ…å«â¼€ä¸ªæˆ–å¤šä¸ªsample

stblâ½¤æ¥æè¿°æ¯ä¸ªsampleçš„ä¿¡æ¯ï¼ŒåŒ…å«ä»¥ä¸‹å‡ ä¸ªä¸»è¦çš„å­box : 

## 4.1 stsd

Sample Description Box , å­˜æ”¾è§£ç å¿…é¡»çš„æè¿°ä¿¡æ¯

å¯¹äºh264çš„è§†é¢‘æµ , å…¶å…·ä½“ç±»å‹ä¸º avc1 , extensionsä¸­å…¶ä¸­å­˜æ”¾æœ‰sps , ppsç­‰è§£ç å¿…è¦ä¿¡æ¯

1. è§†é¢‘stsdå†…å®¹

> ```tex
> 14CFCF      Sample Description (174 bytes)
> 14CFCF       Header (8 bytes)
> 14CFCF        Size:                            174 (0x000000AE)
> 14CFD3        Name:                            stsd
> 14CFD7       Version:                          0 (0x00)
> 14CFD8       Flags:                            0 (0x000000)
> 14CFDB       Count:                            1 (0x00000001)
> ```

<img src="assets/image-20240311152434467.png" alt="image-20240311152434467" /> 

é‡Œé¢åŒ…å«äº†avc1ï¼Œavc1é‡Œé¢â¼œåŒ…å«äº†avcCå’Œpasp  

<img src="assets/image-20240311152128041.png" alt="image-20240311152128041" /> 

* avc1 : åŒ…å«äº†è§†é¢‘Widthã€Height

> ```tex
> 14CFDF       Video (158 bytes)
> 14CFDF        Header (8 bytes)
> 14CFDF         Size:                           158 (0x0000009E)
> 14CFE3         Name:                           avc1
> 14CFE7        Reserved:                        0 (0x0000000000000000)
> 14CFED        Data reference index:            1 (0x0001)
> 14CFEF        Version:                         0 (0x0000)
> 14CFF1        Revision level:                  0 (0x0000)
> 14CFF3        Vendor:                          
> 14CFF7        Temporal quality:                0 (0x00000000)
> 14CFFB        Spatial quality:                 0 (0x00000000)
> 14CFFF        Width:                           1920 (0x0780)
> 14D001        Height:                          800 (0x0320)
> 14D003        Horizontal resolution:           4718592 (0x00480000)
> 14D007        Vertical resolution:             4718592 (0x00480000)
> 14D00B        Data size:                       0 (0x00000000)
> 14D00F        Frame count:                     1 (0x0001)
> 14D011        Compressor name size:            0 (0x00)
> 14D012        Padding:                         (31 bytes)
> 14D031        Depth:                           24 (0x0018)
> 14D033        Color table ID:                  65535 (0xFFFF)
> ```

<img src="assets/image-20240311160102067.png" alt="image-20240311160102067" /> 

* avcC : åŒ…å«äº†è§†é¢‘ç¼–ç å™¨ç›¸å…³çš„ä¿¡æ¯ , åŒ…æ‹¬spsã€ppsç­‰ä¿¡æ¯ 

> ```tex
> 14D035        AVC decode (56 bytes)
> 14D035         Header (8 bytes)
> 14D035          Size:                          56 (0x00000038)
> 14D039          Name:                          avcC
> 14D03D         Version:                        1 (0x01)
> 14D03E         Specific (47 bytes)
> 14D03E          AVCProfileIndication:          100 (0x64)
> 14D03F          profile_compatibility:         0 (0x00)
> 14D040          AVCLevelIndication:            40 (0x28)
> 14D041          reserved:                      63 (0x3F) - (6 bits)
> 14D041          lengthSizeMinusOne:            3 (0x3) - (2 bits)
> 14D042          reserved:                      7 (0x7) - (3 bits)
> 14D042          numOfSequenceParameterSets:    1 (0x01) - (5 bits)
> 14D043          seq_parameter_set (30 bytes)
> 14D043           sequenceParameterSetLength:   28 (0x001C)
> 14D045           nal_ref_idc:                  3 (0x3) - (2 bits)
> 14D045           nal_unit_type:                7 (0x7) - (5 bits)
> 14D046           profile_idc:                  100 (0x64)
> 14D047           constraint_sett_flags:        0 (0x00)
> 14D048           constraint_sett0_flag:        No
> 14D048           constraint_sett1_flag:        No
> 14D048           constraint_sett2_flag:        No
> 14D048           constraint_sett3_flag:        No
> 14D048           constraint_sett4_flag:        No
> 14D048           constraint_sett5_flag:        No
> 14D048           constraint_sett6_flag:        No
> 14D048           constraint_sett7_flag:        No
> 14D048           level_idc:                    40 (0x28)
> 14D049           seq_parameter_set_id:         0 (0x0)
> 14D049           high profile specific (1 bytes)
> 14D049            chroma_format_idc:           1 (0x1) - 4:2:0
> 14D049            bit_depth_luma_minus8:       0 (0x0)
> 14D049            bit_depth_chroma_minus8:     0 (0x0)
> 14D049            qpprime_y_zero_transform_bypass_flag: No
> 14D049            seq_scaling_matrix_present_flag: No
> 14D04A           log2_max_frame_num_minus4:    0 (0x0)
> 14D04A           pic_order_cnt_type:           0 (0x0)
> 14D04A           log2_max_pic_order_cnt_lsb_minus4: 2 (0x2)
> 14D04A           max_num_ref_frames:           3 (0x3)
> 14D04B           gaps_in_frame_num_value_allowed_flag: No
> 14D04B           pic_width_in_mbs_minus1:      119 (0x077)
> 14D04D           pic_height_in_map_units_minus1: 49 (0x031)
> 14D04E           frame_mbs_only_flag:          Yes
> 14D04E           direct_8x8_inference_flag:    Yes
> 14D04E           frame_cropping_flag:          No
> 14D04E           vui_parameters_present_flag (17 bytes)
> 14D04E            vui_parameters_present_flag: Yes
> 14D04E            aspect_ratio_info_present_flag (2 bytes)
> 14D04E             aspect_ratio_info_present_flag: Yes
> 14D04F             aspect_ratio_idc:           1 (0x01) - (8 bits) - 1.000
> 14D050            overscan_info_present_flag:  No
> 14D050            video_signal_type_present_flag (3 bytes)
> 14D050             video_signal_type_present_flag: Yes
> 14D050             video_format:               5 (0x5) - (3 bits) - 
> 14D050             video_full_range_flag:      0 (0x0) - (1 bits) - Limited
> 14D050             colour_description_present_flag (3 bytes)
> 14D050              colour_description_present_flag: Yes
> 14D050              colour_primaries:          1 (0x01) - (8 bits) - BT.709
> 14D051              transfer_characteristics:  1 (0x01) - (8 bits) - BT.709
> 14D052              matrix_coefficients:       1 (0x01) - (8 bits) - BT.709
> 14D053            chroma_loc_info_present_flag: No
> 14D054            timing_info_present_flag (8 bytes)
> 14D054             timing_info_present_flag:   Yes
> 14D054             num_units_in_tick:          1 (0x00000001) - (32 bits)
> 14D058             time_scale:                 48 (0x00000030) - (32 bits)
> 14D05C             fixed_frame_rate_flag:      Yes
> 14D05C            nal_hrd_parameters_present_flag: No
> 14D05C            vcl_hrd_parameters_present_flag: No
> 14D05C            pic_struct_present_flag:     No
> 14D05C            bitstream_restriction_flag (3 bytes)
> 14D05C             bitstream_restriction_flag: Yes
> 14D05C             motion_vectors_over_pic_boundaries_flag: Yes
> 14D05D             max_bytes_per_pic_denom:    0 (0x0)
> 14D05D             max_bits_per_mb_denom:      0 (0x0)
> 14D05D             log2_max_mv_length_horizontal: 11 (0x0B)
> 14D05E             log2_max_mv_length_vertical: 11 (0x0B)
> 14D05F             max_num_reorder_frames:     2 (0x2)
> 14D05F             max_dec_frame_buffering:    4 (0x4)
> 14D061          numOfPictureParameterSets:     1 (0x01)
> 14D062          pic_parameter_set (6 bytes)
> 14D062           pictureParameterSetLength:    5 (0x0005)
> 14D064           nal_ref_idc:                  3 (0x3) - (2 bits)
> 14D064           nal_unit_type:                8 (0x8) - (5 bits)
> 14D065           pic_parameter_set_id:         0 (0x0)
> 14D065           seq_parameter_set_id:         0 (0x0)
> 14D065           entropy_coding_mode_flag:     Yes
> 14D065           bottom_field_pic_order_in_frame_present_flag: No
> 14D065           num_slice_groups_minus1:      0 (0x0)
> 14D065           num_ref_idx_l0_default_active_minus1: 3 (0x3)
> 14D066           num_ref_idx_l1_default_active_minus1: 0 (0x0)
> 14D066           weighted_pred_flag:           No
> 14D066           weighted_bipred_idc:          2 (0x2) - (2 bits)
> 14D066           pic_init_qp_minus26:          0 (0x0)
> 14D067           pic_init_qs_minus26:          0 (0x0)
> 14D067           chroma_qp_index_offset:       0 (0x0)
> 14D067           deblocking_filter_control_present_flag: Yes
> 14D067           constrained_intra_pred_flag:  No
> 14D067           redundant_pic_cnt_present_flag: No
> 14D067           transform_8x8_mode_flag:      Yes
> 14D067           pic_scaling_matrix_present_flag: No
> 14D067           second_chroma_qp_index_offset: 0 (0x0)
> 14D068          -------------------------
> 14D068          ---   AVC, accepted   ---
> 14D068          -------------------------
> 14D069          reserved:                      63 (0x3F) - (6 bits)
> 14D069          chroma_format:                 1 (0x1) - (2 bits)
> 14D06A          reserved:                      31 (0x1F) - (5 bits)
> 14D06A          bit_depth_luma_minus8:         0 (0x0) - (3 bits)
> 14D06B          reserved:                      31 (0x1F) - (5 bits)
> 14D06B          bit_depth_chroma_minus8:       0 (0x0) - (3 bits)
> 14D06C          numOfSequenceParameterSetExt:  0 (0x00)
> 14D06D        Pixel Aspect Ratio (16 bytes)
> 14D06D         Header (8 bytes)
> 14D06D          Size:                          16 (0x00000010)
> 14D071          Name:                          pasp
> 14D075         hSpacing:                       1 (0x00000001)
> 14D079         vSpacing:                       1 (0x00000001)
> ```

<img src="assets/image-20240311160135670.png" alt="image-20240311160135670" /> 

<img src="assets/image-20240311160150234.png" alt="image-20240311160150234" /> 

2. éŸ³é¢‘çš„stsd 

åŒ…å«äº†éŸ³é¢‘ç›¸å…³çš„ä¿¡æ¯ , æ¯”å¦‚é‡‡æ ·ç‡ , é€šé“æ•°é‡ç­‰

<img src="assets/image-20240311155629542.png" alt="image-20240311155629542" /> 

<img src="assets/image-20240311160530793.png" alt="image-20240311160530793" /> 

<img src="assets/image-20240311160231596.png" alt="image-20240311160231596" /> 

## 4.2 stts

Time-to-Sample Box , å®šä¹‰æ¯ä¸ªsampleæ—¶é•¿ã€‚Time-To-Sampleçš„table entryå¸ƒå±€å¦‚ä¸‹ : 

<img src="assets/image-20240311160709507.png" alt="image-20240311160709507" /> 

stts table entryå¸ƒå±€  

- sample count : sampleä¸ªæ•°
- sample duration : sampleæŒç»­æ—¶é—´  

**$\color{red}{\mathbf{æŒç»­æ—¶é—´ç›¸åŒçš„è¿ç»­sampleå¯ä»¥æ”¾åˆ°â¼€ä¸ªentryâ¾¥è¾¾åˆ°èŠ‚çœç©ºé—´çš„ç›®çš„}}$**

è¿™â¾¥å…ˆç»™å‡ºæ¥çš„æ˜¯è§†é¢‘çš„ stts , Number of entries , **$\color{red}{\mathbf{è¿™ä¸ªå‚æ•°éœ€è¦æ³¨æ„å¹¶ä¸æ˜¯sampleçš„ä¸ªæ•°\ , sampleçš„å®é™…æ•°é‡éœ€è¦å°†æ¯ä¸ªentry\ çš„\ sample\ count\ è¿›è¡Œç´¯åŠ æ‰æ˜¯çœŸæ­£çš„sampleä¸ªæ•°}}$â€‹â€‹** å‚è€ƒä¸‹é¢çš„æ•°æ®ä¸ºä¾‹å­ sample total = 1+1+1+2+...+2+1

ä¸‹é¢æ–‡æœ¬ç¤ºä¾‹ä¸­ , ç¬¬1ä¸ªsampleæ—¶é—´ä¸º3720 , å•ä½ç”¨mdhdçš„time scaleè¿›è¡Œæ¢ç®— , æ¯”å¦‚è§†é¢‘çš„(Time scale)æ˜¯90000 , æ­¤æ—¶æ¢ç®—æˆç§’ä¸º3720 Ã· 90000 = 0.0413333333333333ç§’ = 41.3333333333333ms

1. è§†é¢‘sttså†…å®¹

> ```tex
> 14D07D      Time to Sample (664 bytes)
> 14D07D       Header (8 bytes)
> 14D07D        Size:                            664 (0x00000298)
> 14D081        Name:                            stts
> 14D085       Version:                          0 (0x00)
> 14D086       Flags:                            0 (0x000000)
> 14D089       Number of entries:                81 (0x00000051)
> 14D08D       Sample Count:                     1 (0x00000001)
> 14D091       Sample Duration:                  3720 (0x00000E88)
> 14D095       Sample Count:                     1 (0x00000001)
> 14D099       Sample Duration:                  3780 (0x00000EC4)
> 14D09D       Sample Count:                     1 (0x00000001)
> 14D0A1       Sample Duration:                  3690 (0x00000E6A)
> 14D0A5       Sample Count:                     2 (0x00000002)
> 14D0A9       Sample Duration:                  3780 (0x00000EC4)
> 14D0AD       Sample Count:                     1 (0x00000001)
> 14D0B1       Sample Duration:                  3690 (0x00000E6A)
> 14D0B5       Sample Count:                     2 (0x00000002)
> 14D0B9       Sample Duration:                  3780 (0x00000EC4)
> 14D0BD       Sample Count:                     1 (0x00000001)
> 14D0C1       Sample Duration:                  3690 (0x00000E6A)
> 14D0C5       Sample Count:                     2 (0x00000002)
> 14D0C9       Sample Duration:                  3780 (0x00000EC4)
> 14D0CD       Sample Count:                     1 (0x00000001)
> 14D0D1       Sample Duration:                  3690 (0x00000E6A)
> 14D0D5       Sample Count:                     2 (0x00000002)
> 14D0D9       Sample Duration:                  3780 (0x00000EC4)
> 14D0DD       Sample Count:                     1 (0x00000001)
> 14D0E1       Sample Duration:                  3690 (0x00000E6A)
> 14D0E5       Sample Count:                     2 (0x00000002)
> 14D0E9       Sample Duration:                  3780 (0x00000EC4)
> 14D0ED       Sample Count:                     1 (0x00000001)
> 14D0F1       Sample Duration:                  3690 (0x00000E6A)
> 14D0F5       Sample Count:                     2 (0x00000002)
> 14D0F9       Sample Duration:                  3780 (0x00000EC4)
> 14D0FD       Sample Count:                     1 (0x00000001)
> 14D101       Sample Duration:                  3690 (0x00000E6A)
> 14D105       Sample Count:                     2 (0x00000002)
> 14D109       Sample Duration:                  3780 (0x00000EC4)
> 14D10D       Sample Count:                     1 (0x00000001)
> 14D111       Sample Duration:                  3690 (0x00000E6A)
> 14D115       Sample Count:                     2 (0x00000002)
> 14D119       Sample Duration:                  3780 (0x00000EC4)
> 14D11D       Sample Count:                     1 (0x00000001)
> 14D121       Sample Duration:                  3690 (0x00000E6A)
> 14D125       Sample Count:                     2 (0x00000002)
> 14D129       Sample Duration:                  3780 (0x00000EC4)
> 14D12D       Sample Count:                     1 (0x00000001)
> 14D131       Sample Duration:                  3690 (0x00000E6A)
> 14D135       Sample Count:                     2 (0x00000002)
> 14D139       Sample Duration:                  3780 (0x00000EC4)
> 14D13D       Sample Count:                     1 (0x00000001)
> 14D141       Sample Duration:                  3690 (0x00000E6A)
> 14D145       Sample Count:                     2 (0x00000002)
> 14D149       Sample Duration:                  3780 (0x00000EC4)
> 14D14D       Sample Count:                     1 (0x00000001)
> 14D151       Sample Duration:                  3690 (0x00000E6A)
> 14D155       Sample Count:                     2 (0x00000002)
> 14D159       Sample Duration:                  3780 (0x00000EC4)
> 14D15D       Sample Count:                     1 (0x00000001)
> 14D161       Sample Duration:                  3690 (0x00000E6A)
> 14D165       Sample Count:                     2 (0x00000002)
> 14D169       Sample Duration:                  3780 (0x00000EC4)
> 14D16D       Sample Count:                     1 (0x00000001)
> 14D171       Sample Duration:                  3690 (0x00000E6A)
> 14D175       Sample Count:                     2 (0x00000002)
> 14D179       Sample Duration:                  3780 (0x00000EC4)
> 14D17D       Sample Count:                     1 (0x00000001)
> 14D181       Sample Duration:                  3690 (0x00000E6A)
> 14D185       Sample Count:                     2 (0x00000002)
> 14D189       Sample Duration:                  3780 (0x00000EC4)
> 14D18D       Sample Count:                     1 (0x00000001)
> 14D191       Sample Duration:                  3690 (0x00000E6A)
> 14D195       Sample Count:                     2 (0x00000002)
> 14D199       Sample Duration:                  3780 (0x00000EC4)
> 14D19D       Sample Count:                     1 (0x00000001)
> 14D1A1       Sample Duration:                  3690 (0x00000E6A)
> 14D1A5       Sample Count:                     1 (0x00000001)
> 14D1A9       Sample Duration:                  3780 (0x00000EC4)
> 14D1AD       Sample Count:                     1 (0x00000001)
> 14D1B1       Sample Duration:                  3750 (0x00000EA6)
> 14D1B5       Sample Count:                     1 (0x00000001)
> 14D1B9       Sample Duration:                  3720 (0x00000E88)
> 14D1BD       Sample Count:                     2 (0x00000002)
> 14D1C1       Sample Duration:                  3780 (0x00000EC4)
> 14D1C5       Sample Count:                     1 (0x00000001)
> 14D1C9       Sample Duration:                  3690 (0x00000E6A)
> 14D1CD       Sample Count:                     2 (0x00000002)
> 14D1D1       Sample Duration:                  3780 (0x00000EC4)
> 14D1D5       Sample Count:                     1 (0x00000001)
> 14D1D9       Sample Duration:                  3690 (0x00000E6A)
> 14D1DD       Sample Count:                     2 (0x00000002)
> 14D1E1       Sample Duration:                  3780 (0x00000EC4)
> 14D1E5       Sample Count:                     1 (0x00000001)
> 14D1E9       Sample Duration:                  3690 (0x00000E6A)
> 14D1ED       Sample Count:                     2 (0x00000002)
> 14D1F1       Sample Duration:                  3780 (0x00000EC4)
> 14D1F5       Sample Count:                     1 (0x00000001)
> 14D1F9       Sample Duration:                  3690 (0x00000E6A)
> 14D1FD       Sample Count:                     2 (0x00000002)
> 14D201       Sample Duration:                  3780 (0x00000EC4)
> 14D205       Sample Count:                     1 (0x00000001)
> 14D209       Sample Duration:                  3690 (0x00000E6A)
> 14D20D       Sample Count:                     2 (0x00000002)
> 14D211       Sample Duration:                  3780 (0x00000EC4)
> 14D215       Sample Count:                     1 (0x00000001)
> 14D219       Sample Duration:                  3690 (0x00000E6A)
> 14D21D       Sample Count:                     2 (0x00000002)
> 14D221       Sample Duration:                  3780 (0x00000EC4)
> 14D225       Sample Count:                     1 (0x00000001)
> 14D229       Sample Duration:                  3690 (0x00000E6A)
> 14D22D       Sample Count:                     2 (0x00000002)
> 14D231       Sample Duration:                  3780 (0x00000EC4)
> 14D235       Sample Count:                     1 (0x00000001)
> 14D239       Sample Duration:                  3690 (0x00000E6A)
> 14D23D       Sample Count:                     2 (0x00000002)
> 14D241       Sample Duration:                  3780 (0x00000EC4)
> 14D245       Sample Count:                     1 (0x00000001)
> 14D249       Sample Duration:                  3690 (0x00000E6A)
> 14D24D       Sample Count:                     2 (0x00000002)
> 14D251       Sample Duration:                  3780 (0x00000EC4)
> 14D255       Sample Count:                     1 (0x00000001)
> 14D259       Sample Duration:                  3690 (0x00000E6A)
> 14D25D       Sample Count:                     2 (0x00000002)
> 14D261       Sample Duration:                  3780 (0x00000EC4)
> 14D265       Sample Count:                     1 (0x00000001)
> 14D269       Sample Duration:                  3690 (0x00000E6A)
> 14D26D       Sample Count:                     2 (0x00000002)
> 14D271       Sample Duration:                  3780 (0x00000EC4)
> 14D275       Sample Count:                     1 (0x00000001)
> 14D279       Sample Duration:                  3690 (0x00000E6A)
> 14D27D       Sample Count:                     2 (0x00000002)
> 14D281       Sample Duration:                  3780 (0x00000EC4)
> 14D285       Sample Count:                     1 (0x00000001)
> 14D289       Sample Duration:                  3690 (0x00000E6A)
> 14D28D       Sample Count:                     2 (0x00000002)
> 14D291       Sample Duration:                  3780 (0x00000EC4)
> 14D295       Sample Count:                     1 (0x00000001)
> 14D299       Sample Duration:                  3690 (0x00000E6A)
> 14D29D       Sample Count:                     2 (0x00000002)
> 14D2A1       Sample Duration:                  3780 (0x00000EC4)
> 14D2A5       Sample Count:                     1 (0x00000001)
> 14D2A9       Sample Duration:                  3690 (0x00000E6A)
> 14D2AD       Sample Count:                     2 (0x00000002)
> 14D2B1       Sample Duration:                  3780 (0x00000EC4)
> 14D2B5       Sample Count:                     1 (0x00000001)
> 14D2B9       Sample Duration:                  3750 (0x00000EA6)
> 14D2BD       Sample Count:                     1 (0x00000001)
> 14D2C1       Sample Duration:                  3720 (0x00000E88)
> 14D2C5       Sample Count:                     1 (0x00000001)
> 14D2C9       Sample Duration:                  3780 (0x00000EC4)
> 14D2CD       Sample Count:                     1 (0x00000001)
> 14D2D1       Sample Duration:                  3690 (0x00000E6A)
> 14D2D5       Sample Count:                     2 (0x00000002)
> 14D2D9       Sample Duration:                  3780 (0x00000EC4)
> 14D2DD       Sample Count:                     1 (0x00000001)
> 14D2E1       Sample Duration:                  3690 (0x00000E6A)
> 14D2E5       Sample Count:                     2 (0x00000002)
> 14D2E9       Sample Duration:                  3780 (0x00000EC4)
> 14D2ED       Sample Count:                     1 (0x00000001)
> 14D2F1       Sample Duration:                  3690 (0x00000E6A)
> 14D2F5       Sample Count:                     2 (0x00000002)
> 14D2F9       Sample Duration:                  3780 (0x00000EC4)
> 14D2FD       Sample Count:                     1 (0x00000001)
> 14D301       Sample Duration:                  3690 (0x00000E6A)
> 14D305       Sample Count:                     2 (0x00000002)
> 14D309       Sample Duration:                  3780 (0x00000EC4)
> 14D30D       Sample Count:                     1 (0x00000001)
> 14D311       Sample Duration:                  3750 (0x00000EA6)
> ```

<img src="assets/image-20240311171430578.png" alt="image-20240311171430578" /> 

2. éŸ³é¢‘çš„stts

åªæ˜¯mdhdçš„ time scale çš„å·®åˆ« , ä¹‹å‰æˆ‘ä»¬çœ‹åˆ°â¾³é¢‘ä¸º44100 , åˆ™è®¡ç®—ç¬¬â¼€ä¸ªsampleçš„æ—¶é—´ 1024/44100=0.0232199546485261ç§’ = 23.2199546485261ms

> ```tex
> 14B4C4      Time to Sample (1048 bytes)
> 14B4C4       Header (8 bytes)
> 14B4C4        Size:                            1048 (0x00000418)
> 14B4C8        Name:                            stts
> 14B4CC       Version:                          0 (0x00)
> 14B4CD       Flags:                            0 (0x000000)
> 14B4D0       Number of entries:                129 (0x00000081)
> 14B4D4       Sample Count:                     1 (0x00000001)
> 14B4D8       Sample Duration:                  1024 (0x00000400)
> 14B4DC       Sample Count:                     1 (0x00000001)
> 14B4E0       Sample Duration:                  1025 (0x00000401)
> 14B4E4       Sample Count:                     2 (0x00000002)
> 14B4E8       Sample Duration:                  1024 (0x00000400)
> 14B4EC       Sample Count:                     1 (0x00000001)
> 14B4F0       Sample Duration:                  1023 (0x000003FF)
> 14B4F4       Sample Count:                     1 (0x00000001)
> 14B4F8       Sample Duration:                  1024 (0x00000400)
> 14B4FC       Sample Count:                     1 (0x00000001)
> 14B500       Sample Duration:                  1025 (0x00000401)
> 14B504       Sample Count:                     1 (0x00000001)
> 14B508       Sample Duration:                  1024 (0x00000400)
> 14B50C       Sample Count:                     1 (0x00000001)
> 14B510       Sample Duration:                  1023 (0x000003FF)
> 14B514       Sample Count:                     2 (0x00000002)
> 14B518       Sample Duration:                  1024 (0x00000400)
> 14B51C       Sample Count:                     1 (0x00000001)
> 14B520       Sample Duration:                  1025 (0x00000401)
> 14B524       Sample Count:                     1 (0x00000001)
> 14B528       Sample Duration:                  1024 (0x00000400)
> 14B52C       Sample Count:                     1 (0x00000001)
> 14B530       Sample Duration:                  1023 (0x000003FF)
> 14B534       Sample Count:                     2 (0x00000002)
> 14B538       Sample Duration:                  1024 (0x00000400)
> 14B53C       Sample Count:                     1 (0x00000001)
> 14B540       Sample Duration:                  1025 (0x00000401)
> 14B544       Sample Count:                     1 (0x00000001)
> 14B548       Sample Duration:                  1024 (0x00000400)
> 14B54C       Sample Count:                     1 (0x00000001)
> 14B550       Sample Duration:                  1023 (0x000003FF)
> 14B554       Sample Count:                     2 (0x00000002)
> 14B558       Sample Duration:                  1024 (0x00000400)
> 14B55C       Sample Count:                     1 (0x00000001)
> 14B560       Sample Duration:                  1025 (0x00000401)
> 14B564       Sample Count:                     1 (0x00000001)
> 14B568       Sample Duration:                  1024 (0x00000400)
> 14B56C       Sample Count:                     1 (0x00000001)
> 14B570       Sample Duration:                  1023 (0x000003FF)
> 14B574       Sample Count:                     1 (0x00000001)
> 14B578       Sample Duration:                  1024 (0x00000400)
> 14B57C       Sample Count:                     1 (0x00000001)
> 14B580       Sample Duration:                  1025 (0x00000401)
> 14B584       Sample Count:                     2 (0x00000002)
> 14B588       Sample Duration:                  1024 (0x00000400)
> 14B58C       Sample Count:                     1 (0x00000001)
> 14B590       Sample Duration:                  1023 (0x000003FF)
> 14B594       Sample Count:                     1 (0x00000001)
> 14B598       Sample Duration:                  1024 (0x00000400)
> 14B59C       Sample Count:                     1 (0x00000001)
> 14B5A0       Sample Duration:                  1025 (0x00000401)
> 14B5A4       Sample Count:                     2 (0x00000002)
> 14B5A8       Sample Duration:                  1024 (0x00000400)
> 14B5AC       Sample Count:                     1 (0x00000001)
> 14B5B0       Sample Duration:                  1023 (0x000003FF)
> 14B5B4       Sample Count:                     1 (0x00000001)
> 14B5B8       Sample Duration:                  1024 (0x00000400)
> 14B5BC       Sample Count:                     1 (0x00000001)
> 14B5C0       Sample Duration:                  1025 (0x00000401)
> 14B5C4       Sample Count:                     2 (0x00000002)
> 14B5C8       Sample Duration:                  1024 (0x00000400)
> 14B5CC       Sample Count:                     1 (0x00000001)
> 14B5D0       Sample Duration:                  1023 (0x000003FF)
> 14B5D4       Sample Count:                     1 (0x00000001)
> 14B5D8       Sample Duration:                  1024 (0x00000400)
> 14B5DC       Sample Count:                     1 (0x00000001)
> 14B5E0       Sample Duration:                  1025 (0x00000401)
> 14B5E4       Sample Count:                     2 (0x00000002)
> 14B5E8       Sample Duration:                  1024 (0x00000400)
> 14B5EC       Sample Count:                     1 (0x00000001)
> 14B5F0       Sample Duration:                  1023 (0x000003FF)
> 14B5F4       Sample Count:                     1 (0x00000001)
> 14B5F8       Sample Duration:                  1024 (0x00000400)
> 14B5FC       Sample Count:                     1 (0x00000001)
> 14B600       Sample Duration:                  1025 (0x00000401)
> 14B604       Sample Count:                     2 (0x00000002)
> 14B608       Sample Duration:                  1024 (0x00000400)
> 14B60C       Sample Count:                     1 (0x00000001)
> 14B610       Sample Duration:                  1023 (0x000003FF)
> 14B614       Sample Count:                     1 (0x00000001)
> 14B618       Sample Duration:                  1024 (0x00000400)
> 14B61C       Sample Count:                     1 (0x00000001)
> 14B620       Sample Duration:                  1025 (0x00000401)
> 14B624       Sample Count:                     2 (0x00000002)
> 14B628       Sample Duration:                  1024 (0x00000400)
> 14B62C       Sample Count:                     1 (0x00000001)
> 14B630       Sample Duration:                  1023 (0x000003FF)
> 14B634       Sample Count:                     1 (0x00000001)
> 14B638       Sample Duration:                  1024 (0x00000400)
> 14B63C       Sample Count:                     1 (0x00000001)
> 14B640       Sample Duration:                  1025 (0x00000401)
> 14B644       Sample Count:                     50 (0x00000032)
> 14B648       Sample Duration:                  1024 (0x00000400)
> 14B64C       Sample Count:                     1 (0x00000001)
> 14B650       Sample Duration:                  1023 (0x000003FF)
> 14B654       Sample Count:                     2 (0x00000002)
> 14B658       Sample Duration:                  1024 (0x00000400)
> 14B65C       Sample Count:                     1 (0x00000001)
> 14B660       Sample Duration:                  1025 (0x00000401)
> 14B664       Sample Count:                     1 (0x00000001)
> 14B668       Sample Duration:                  1024 (0x00000400)
> 14B66C       Sample Count:                     1 (0x00000001)
> 14B670       Sample Duration:                  1023 (0x000003FF)
> 14B674       Sample Count:                     2 (0x00000002)
> 14B678       Sample Duration:                  1024 (0x00000400)
> 14B67C       Sample Count:                     1 (0x00000001)
> 14B680       Sample Duration:                  1025 (0x00000401)
> 14B684       Sample Count:                     1 (0x00000001)
> 14B688       Sample Duration:                  1024 (0x00000400)
> 14B68C       Sample Count:                     1 (0x00000001)
> 14B690       Sample Duration:                  1023 (0x000003FF)
> 14B694       Sample Count:                     2 (0x00000002)
> 14B698       Sample Duration:                  1024 (0x00000400)
> 14B69C       Sample Count:                     1 (0x00000001)
> 14B6A0       Sample Duration:                  1025 (0x00000401)
> 14B6A4       Sample Count:                     1 (0x00000001)
> 14B6A8       Sample Duration:                  1024 (0x00000400)
> 14B6AC       Sample Count:                     1 (0x00000001)
> 14B6B0       Sample Duration:                  1023 (0x000003FF)
> 14B6B4       Sample Count:                     1 (0x00000001)
> 14B6B8       Sample Duration:                  1024 (0x00000400)
> 14B6BC       Sample Count:                     1 (0x00000001)
> 14B6C0       Sample Duration:                  1025 (0x00000401)
> 14B6C4       Sample Count:                     2 (0x00000002)
> 14B6C8       Sample Duration:                  1024 (0x00000400)
> 14B6CC       Sample Count:                     1 (0x00000001)
> 14B6D0       Sample Duration:                  1023 (0x000003FF)
> 14B6D4       Sample Count:                     1 (0x00000001)
> 14B6D8       Sample Duration:                  1024 (0x00000400)
> 14B6DC       Sample Count:                     1 (0x00000001)
> 14B6E0       Sample Duration:                  1025 (0x00000401)
> 14B6E4       Sample Count:                     2 (0x00000002)
> 14B6E8       Sample Duration:                  1024 (0x00000400)
> 14B6EC       Sample Count:                     1 (0x00000001)
> 14B6F0       Sample Duration:                  1023 (0x000003FF)
> 14B6F4       Sample Count:                     1 (0x00000001)
> 14B6F8       Sample Duration:                  1024 (0x00000400)
> 14B6FC       Sample Count:                     1 (0x00000001)
> 14B700       Sample Duration:                  1025 (0x00000401)
> 14B704       Sample Count:                     2 (0x00000002)
> 14B708       Sample Duration:                  1024 (0x00000400)
> 14B70C       Sample Count:                     1 (0x00000001)
> 14B710       Sample Duration:                  1023 (0x000003FF)
> 14B714       Sample Count:                     1 (0x00000001)
> 14B718       Sample Duration:                  1024 (0x00000400)
> 14B71C       Sample Count:                     1 (0x00000001)
> 14B720       Sample Duration:                  1025 (0x00000401)
> 14B724       Sample Count:                     2 (0x00000002)
> 14B728       Sample Duration:                  1024 (0x00000400)
> 14B72C       Sample Count:                     1 (0x00000001)
> 14B730       Sample Duration:                  1023 (0x000003FF)
> 14B734       Sample Count:                     1 (0x00000001)
> 14B738       Sample Duration:                  1024 (0x00000400)
> 14B73C       Sample Count:                     1 (0x00000001)
> 14B740       Sample Duration:                  1025 (0x00000401)
> 14B744       Sample Count:                     2 (0x00000002)
> 14B748       Sample Duration:                  1024 (0x00000400)
> 14B74C       Sample Count:                     1 (0x00000001)
> 14B750       Sample Duration:                  1023 (0x000003FF)
> 14B754       Sample Count:                     1 (0x00000001)
> 14B758       Sample Duration:                  1024 (0x00000400)
> 14B75C       Sample Count:                     1 (0x00000001)
> 14B760       Sample Duration:                  1025 (0x00000401)
> 14B764       Sample Count:                     2 (0x00000002)
> 14B768       Sample Duration:                  1024 (0x00000400)
> 14B76C       Sample Count:                     1 (0x00000001)
> 14B770       Sample Duration:                  1023 (0x000003FF)
> 14B774       Sample Count:                     1 (0x00000001)
> 14B778       Sample Duration:                  1024 (0x00000400)
> 14B77C       Sample Count:                     1 (0x00000001)
> 14B780       Sample Duration:                  1025 (0x00000401)
> 14B784       Sample Count:                     1 (0x00000001)
> 14B788       Sample Duration:                  1024 (0x00000400)
> 14B78C       Sample Count:                     1 (0x00000001)
> 14B790       Sample Duration:                  1023 (0x000003FF)
> 14B794       Sample Count:                     2 (0x00000002)
> 14B798       Sample Duration:                  1024 (0x00000400)
> 14B79C       Sample Count:                     1 (0x00000001)
> 14B7A0       Sample Duration:                  1025 (0x00000401)
> 14B7A4       Sample Count:                     1 (0x00000001)
> 14B7A8       Sample Duration:                  1024 (0x00000400)
> 14B7AC       Sample Count:                     1 (0x00000001)
> 14B7B0       Sample Duration:                  1023 (0x000003FF)
> 14B7B4       Sample Count:                     2 (0x00000002)
> 14B7B8       Sample Duration:                  1024 (0x00000400)
> 14B7BC       Sample Count:                     1 (0x00000001)
> 14B7C0       Sample Duration:                  1025 (0x00000401)
> 14B7C4       Sample Count:                     1 (0x00000001)
> 14B7C8       Sample Duration:                  1024 (0x00000400)
> 14B7CC       Sample Count:                     1 (0x00000001)
> 14B7D0       Sample Duration:                  1023 (0x000003FF)
> 14B7D4       Sample Count:                     2 (0x00000002)
> 14B7D8       Sample Duration:                  1024 (0x00000400)
> 14B7DC       Sample Count:                     1 (0x00000001)
> 14B7E0       Sample Duration:                  1025 (0x00000401)
> 14B7E4       Sample Count:                     1 (0x00000001)
> 14B7E8       Sample Duration:                  1024 (0x00000400)
> 14B7EC       Sample Count:                     1 (0x00000001)
> 14B7F0       Sample Duration:                  1023 (0x000003FF)
> 14B7F4       Sample Count:                     1 (0x00000001)
> 14B7F8       Sample Duration:                  1024 (0x00000400)
> 14B7FC       Sample Count:                     1 (0x00000001)
> 14B800       Sample Duration:                  1025 (0x00000401)
> 14B804       Sample Count:                     2 (0x00000002)
> 14B808       Sample Duration:                  1024 (0x00000400)
> 14B80C       Sample Count:                     1 (0x00000001)
> 14B810       Sample Duration:                  1023 (0x000003FF)
> 14B814       Sample Count:                     1 (0x00000001)
> 14B818       Sample Duration:                  1024 (0x00000400)
> 14B81C       Sample Count:                     1 (0x00000001)
> 14B820       Sample Duration:                  1025 (0x00000401)
> 14B824       Sample Count:                     2 (0x00000002)
> 14B828       Sample Duration:                  1024 (0x00000400)
> 14B82C       Sample Count:                     1 (0x00000001)
> 14B830       Sample Duration:                  1023 (0x000003FF)
> 14B834       Sample Count:                     1 (0x00000001)
> 14B838       Sample Duration:                  1024 (0x00000400)
> 14B83C       Sample Count:                     1 (0x00000001)
> 14B840       Sample Duration:                  1025 (0x00000401)
> 14B844       Sample Count:                     2 (0x00000002)
> 14B848       Sample Duration:                  1024 (0x00000400)
> 14B84C       Sample Count:                     1 (0x00000001)
> 14B850       Sample Duration:                  1023 (0x000003FF)
> 14B854       Sample Count:                     1 (0x00000001)
> 14B858       Sample Duration:                  1024 (0x00000400)
> 14B85C       Sample Count:                     1 (0x00000001)
> 14B860       Sample Duration:                  1025 (0x00000401)
> 14B864       Sample Count:                     2 (0x00000002)
> 14B868       Sample Duration:                  1024 (0x00000400)
> 14B86C       Sample Count:                     1 (0x00000001)
> 14B870       Sample Duration:                  1023 (0x000003FF)
> 14B874       Sample Count:                     1 (0x00000001)
> 14B878       Sample Duration:                  1024 (0x00000400)
> 14B87C       Sample Count:                     1 (0x00000001)
> 14B880       Sample Duration:                  1025 (0x00000401)
> 14B884       Sample Count:                     2 (0x00000002)
> 14B888       Sample Duration:                  1024 (0x00000400)
> 14B88C       Sample Count:                     1 (0x00000001)
> 14B890       Sample Duration:                  1023 (0x000003FF)
> 14B894       Sample Count:                     1 (0x00000001)
> 14B898       Sample Duration:                  1024 (0x00000400)
> 14B89C       Sample Count:                     1 (0x00000001)
> 14B8A0       Sample Duration:                  1025 (0x00000401)
> 14B8A4       Sample Count:                     2 (0x00000002)
> 14B8A8       Sample Duration:                  1024 (0x00000400)
> 14B8AC       Sample Count:                     1 (0x00000001)
> 14B8B0       Sample Duration:                  1023 (0x000003FF)
> 14B8B4       Sample Count:                     1 (0x00000001)
> 14B8B8       Sample Duration:                  1024 (0x00000400)
> 14B8BC       Sample Count:                     1 (0x00000001)
> 14B8C0       Sample Duration:                  1025 (0x00000401)
> 14B8C4       Sample Count:                     11 (0x0000000B)
> 14B8C8       Sample Duration:                  1024 (0x00000400)
> 14B8CC       Sample Count:                     1 (0x00000001)
> 14B8D0       Sample Duration:                  1023 (0x000003FF)
> 14B8D4       Sample Count:                     1 (0x00000001)
> 14B8D8       Sample Duration:                  1024 (0x00000400)
> ```

<img src="assets/image-20240311171450465.png" alt="image-20240311171450465" /> 

## 4.3 stss

**$\color{red}{\mathbf{Sync\ Sample\ Box}}$** (åªé’ˆå¯¹è§†é¢‘) , åŒæ­¥sampleè¡¨ , å­˜æ”¾å…³é”®å¸§åˆ—è¡¨ , å…³é”®å¸§æ˜¯ä¸ºäº†â½€æŒéšæœºè®¿é—®

stssçš„table entryå¸ƒå±€å¦‚ä¸‹ : 

<img src="assets/image-20240311171052113.png" alt="image-20240311171052113" /> 

stss table entryå¸ƒå±€ 

ä¸‹æ–‡ç¤ºä¾‹ä¸­ , è¯¥è§†é¢‘trackæœ‰3ä¸ªå…³é”®å¸§

> ```tex
> 14D315      Sync Sample (28 bytes)
> 14D315       Header (8 bytes)
> 14D315        Size:                            28 (0x0000001C)
> 14D319        Name:                            stss
> 14D31D       Version:                          0 (0x00)
> 14D31E       Flags:                            0 (0x000000)
> 14D321       entry-count:                      3 (0x00000003)
> 14D331      Composition Time To Sample (952 bytes)
> 14D331       Header (8 bytes)
> 14D331        Size:                            952 (0x000003B8)
> 14D335        Name:                            ctts
> 14D339       Version:                          0 (0x00)
> 14D33A       Flags:                            0 (0x000000)
> 14D33D       entry_count:                      117 (0x00000075)
> ```

<img src="assets/image-20240311172101843.png" alt="image-20240311172101843" /> 

## 4.4 stsc

Sample-To-Chunk Box , sample-chunkæ˜ å°„è¡¨ã€‚ä¸Šâ½‚æåˆ°mp4é€šå¸¸æŠŠsampleå°è£…åˆ°chunkä¸­ , ä¸€ä¸ªchunkå¯èƒ½ä¼šåŒ…å«â¼€ä¸ªæˆ–è€…å‡ ä¸ªsample

Sample-To-Chunk Atomçš„table entryå¸ƒå±€å¦‚ä¸‹å›¾æ‰€ç¤º : 

<img src="assets/image-20240311172737766.png" alt="image-20240311172737766" /> 

stsc table entryå¸ƒå±€

- First chunk : ä½¿ç”¨è¯¥è¡¨é¡¹çš„ç¬¬â¼€ä¸ªchunkåºå·
- Samples per chunk : ä½¿ç”¨è¯¥è¡¨é¡¹çš„chunkä¸­åŒ…å«æœ‰å‡ ä¸ªsample
- Sample description ID : ä½¿ç”¨è¯¥è¡¨é¡¹çš„chunkå‚è€ƒçš„stsdè¡¨é¡¹åºå·  

ä¸‹å›¾ç¤ºä¾‹ä¸­ , å¯ä»¥çœ‹åˆ°è¯¥ **è§†é¢‘track** ä¸€å…±æœ‰1ä¸ªstscè¡¨é¡¹ , chunkåºåˆ—1-x , æ¯ä¸ªchunkåŒ…å«â¼€ä¸ªsampleã€‚è¿™é‡Œåˆ™è¯´æ˜æ¯ä¸ªchunké‡Œé¢åªæœ‰â¼€ä¸ªsample (â¼€ä¸ªchunkæ˜¯å¯ä»¥æœ‰å¤šä¸ªsample)

<img src="assets/image-20240311173311179.png" alt="image-20240311173311179" /> 

 ä¸‹å›¾æ˜¯éŸ³é¢‘çš„stscçš„ç¤ºä¾‹ 

<img src="assets/image-20240311174058991.png" alt="image-20240311174058991" /> 

> ```tex
> chunk 1~84 çš„æ¯ä¸ªchunkåŒ…å«1ä¸ªsamples
> chunk 85 åŒ…å«2ä¸ªsamples
> chunk 86~88 çš„æ¯ä¸ªchunkåŒ…å«1ä¸ªsamples
> chunk 89 åŒ…å«2ä¸ªsamples
> chunk 90 åŒ…å«1ä¸ªsamples
> ```

## 4.5 stsz



