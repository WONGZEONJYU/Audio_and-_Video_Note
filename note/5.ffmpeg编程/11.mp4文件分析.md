# 1. Introduction

mp4⽂件格式⼜被称为MPEG-4 Part 14 , 出⾃MPEG-4标准第14部分 .它是⼀种多媒体格式容器，⼴泛⽤于包装视频和⾳频数据流、海报、字幕和元数据等。(顺便⼀提 , ⽬前流⾏的视频编码格式AVC/H264定义在MPEG-4 Part 10)

mp4⽂件格式基于Apple公司的QuickTime格式 , 因此 , [QuickTime File Format Specification](https://developer.apple.com/documentation/quicktime-file-format#//apple_ref/doc/uid/TP40000939-CH202-TPXREF101)也可以作为我们研究mp4的重要参考

MP4⽂件结构的资料 : [link]() 

mp4box⼤杀器 : [link](https://gpac.github.io/mp4box.js/)

# 2. Overview

mp4⽂件由box组成 , 每个box分为Header和Data。其中Header部分包含了box的类型和⼤⼩ , Data包含了⼦box或者数据 , **$\color{red}{\mathbf{box可以嵌套⼦box}}$**

下图是⼀个典型mp4⽂件的基本结构 : 

<img src="./assets/image-20240309203113502.png" alt="image-20240309203113502" />  

MP4⽂件的基本组成单元是box , 也就是说MP4⽂件是由各种各样的box组成的 , 有parent box , 还有children box。因此 , 这些boxes之间存在⼀定的层次关系 , 总结如下表所示 , 表中标记出了各个box必选或可选特性 , √ 代表Box必选

| **$\color{red}{\mathbf{ftyp}}$** |      |      |      |      |      | √    | **$\color{red}{\mathbf{file\ type and\ compatibility}}$**<br />**$\color{red}{\mathbf{⽂件类型和兼容性}}$** |
| -------------------------------- | ---- | ---- | ---- | ---- | ---- | ---- | ------------------------------------------------------------ |
| pdin                             |      |      |      |      |      |      | progressive download information                             |
| moov                             |      |      |      |      |      | √    | **$\color{red}{\mathbf{container\ for\ all\ the\ metadata}}$**<br/>**$\color{red}{\mathbf{所有元数据的容器}}$** |
|                                  | mvhd |      |      |      |      | √    | movie header, overall declarations<br/>电影头,整体声明       |
|                                  | trak |      |      |      |      | √    | container for an individual track or stream<br/>单个轨或流的容器 |
|                                  |      | tkhd |      |      |      | √    | track header, overall information about the track<br />轨的头部 , 关于该轨的概括信息 , ⽐如视频宽⾼ |
|                                  |      |      |      |      |      |      |                                                              |
|                                  |      |      |      |      |      |      |                                                              |
|                                  |      |      |      |      |      |      |                                                              |
|                                  |      |      |      |      |      |      |                                                              |
|                                  |      |      |      |      |      |      |                                                              |
|                                  |      |      |      |      |      |      |                                                              |
|                                  |      |      |      |      |      |      |                                                              |
|                                  |      |      |      |      |      |      |                                                              |





