# 1. FFmpeg合成流程  

本程序会生成一个合成的音频和视频流 , 并将它们编码和封装输出到输出文件 , 输出格式是根据文件扩展名自动猜测的 , 流程图如下 : 

<img src="assets/image-20240407155907947.png" alt="image-20240407155907947" />  

ffmpeg 的 Mux 主要分为三步操作 : 

|                                                         |          |
| ------------------------------------------------------- | -------- |
| `avformat_write_header(...)`                            | 写文件头 |
| `av_write_frame(...) / av_interleaved_write_frame(...)` | 写packet |
| `av_write_trailer(...)`                                 | 写文件尾 |

|                                   |                                                              |
| --------------------------------- | ------------------------------------------------------------ |
| `avcodec_parameters_from_context` | 将AVCodecContext结构体中码流参数拷贝到AVCodecParameters结构体中和avcodec_parameters_to_context刚好相反 |

